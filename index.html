<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nettorechner – Tarifgegenüberstellung</title>

<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#f8fafc;margin:0;padding:16px;color:#0b1020}
  .container{max-width:1120px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,.10);padding:18px}
  h1{text-align:center;color:#1d4ed8;margin:6px 0 14px}
  .top{display:flex;flex-wrap:wrap;gap:10px;align-items:end;justify-content:space-between;margin-bottom:12px}
  label{font-size:12px;font-weight:600;color:#334155}
  .inText{border:1px solid #e2e8f0;border-radius:10px;padding:8px 10px;width:260px;text-align:left}
  .inNum{border:1px solid #e2e8f0;border-radius:10px;padding:7px 10px;width:120px;text-align:right}
  .inRed{color:#dc2626;border-color:#fecaca;font-weight:800}
  select{border:1px solid #e2e8f0;border-radius:10px;padding:8px 10px}
  button{border:none;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;padding:10px 14px;cursor:pointer}
  button:hover{background:#1e40af}

  .grid3{display:grid;grid-template-columns:300px 1fr 1fr}
  .hdr{padding:10px 12px;font-weight:800;color:#fff;text-align:center}
  .hdrTitle{background:#1d4ed8;text-align:left}
  .hdrL{background:#059669}
  .hdrR{background:#6d28d9}

  .rowlabel{padding:9px 12px;font-weight:700;border-top:1px solid #e5e7eb;background:#eff6ff}
  .cell{border-top:1px solid #e5e7eb;padding:8px 10px;text-align:right}
  .bgL{background:#d1fae5}
  .bgR{background:#ede9fe}
  .bold{font-weight:900}
  .taxRow{color:#dc2626}
  .outHdr{margin-top:16px;margin-bottom:6px;font-weight:900;color:#0f172a}
  .note{font-size:12px;color:#334155;margin-top:16px;line-height:1.35}
  .muted{color:#64748b;font-weight:600}
  .right{ text-align:right }
  .center{ text-align:center }
  @media print { .print-hide{display:none !important} body{background:#fff;padding:0} .container{box-shadow:none} }
</style>
</head>

<body>
<div class="container">
  <h1>Tarifgegenüberstellung</h1>

  <div class="top">
    <div>
      <label>Linker Tarif (Freitext)</label><br />
      <input id="labelL" class="inText" value="Tarif A / Bestand" />
    </div>
    <div>
      <label>Rechter Tarif (Freitext)</label><br />
      <input id="labelR" class="inText" value="Tarif B / Vorschlag" />
    </div>
    <div>
      <label>Profil</label><br />
      <select id="profil">
        <option value="Arbeitnehmer">Arbeitnehmer</option>
        <option value="Selbstständig">Selbstständig</option>
      </select>
    </div>
    <div>
      <label>Grenzsteuersatz (%)</label><br />
      <input id="steuer" class="inNum inRed" value="42" />
    </div>
    <button class="print-hide" onclick="window.print()">Drucken</button>
  </div>

  <div class="grid3" id="table">
    <div class="hdr hdrTitle">Position</div>
    <div class="hdr hdrL" id="hdrL">Tarif A / Bestand</div>
    <div class="hdr hdrR" id="hdrR">Tarif B / Vorschlag</div>
    <!-- rows inserted by JS -->
  </div>

  <div class="outHdr">Ergebnis</div>
  <div class="grid3" id="out">
    <!-- results inserted by JS -->
  </div>

  <div class="note">
    Der Rechner wurde von Jürgen Matterne erstellt. Es wurde Sorgfalt verwandt, es kann aber keine Gewähr übernommen werden.
    Fragen bitte an: <a href="mailto:Juergen.Matterne@vk-makler.de">Juergen.Matterne@vk-makler.de</a><br />
    <span class="muted">
      Verwendete Rahmendaten: Arbeitgeber-Höchstzuschuss (KV) 508,59 €; Pflegepflicht 104,63 €. Steuerlich ansetzbar: GesundheitVARIO 91,36%, Pflegepflicht 100%.
    </span>
  </div>
</div>

<script>
  // ---- Konfiguration ----
  // Höchstzuschüsse (AN) – KV und Pflege (wie gewünscht)
  const CAPS = { kv: 508.59, pflege: 104.63 };

  // Felder: key, label, gehört zur KV-Gruppe (AG-Zuschuss möglich) oder Pflegepflicht separat
  // KV-Gruppe = alles außer Pflegepflicht (ppv) (so wie bisher: 50% bis KV-Cap)
  const FIELDS = [
    ["g",   "GesundheitVARIO inkl. RZ/GZ", true],
    ["bea", "Beitragsentlastung / BEA",    true],
    ["ppv", "Pflegepflichtversicherung",   false], // separat (50% bis Pflege-Cap)
    ["vap", "VARIOAmbulant Plus",          true],
    ["vkp", "VARIOKlinik Plus",            true],
    ["vzp", "VARIOZahn Plus",              true],
    ["ktg", "Krankentagegeld",             true],
    ["kur", "Kurtagegeld",                 true],
    ["kht", "KHT",                         true],
    ["pzv", "Pflegezusatzversicherung",    true],
  ];

  // ---- Helpers ----
  function toNum(v){
    const s = String(v ?? "").trim().replace(/\./g,"").replace(",",".");
    const n = Number(s);
    return Number.isFinite(n) ? n : 0;
  }
  function money(n){
    return (Number.isFinite(n)?n:0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}) + " €";
  }

  // ---- UI Render (Input table) ----
  const table = document.getElementById("table");
  function buildRows(){
    let html = "";
    for (const [k, label] of FIELDS){
      html += `
        <div class="rowlabel">${label}</div>
        <div class="cell bgL"><input class="inNum" id="L_${k}" value="0" inputmode="decimal" /></div>
        <div class="cell bgR"><input class="inNum" id="R_${k}" value="0" inputmode="decimal" /></div>
      `;
    }
    // Steuer-Zeile wird oben eingegeben; hier nicht nochmal
    table.insertAdjacentHTML("beforeend", html);
  }
  buildRows();

  // ---- Calculation ----
  function readSide(prefix){
    const v = {};
    for (const [k] of FIELDS){
      v[k] = toNum(document.getElementById(prefix + "_" + k).value);
    }
    return v;
  }

  function sumAll(v){
    return Object.values(v).reduce((a,b)=>a+b,0);
  }

  function sumKVGroup(v){
    // alles "true" (KV-Gruppe) addieren
    let s = 0;
    for (const [k,,isKV] of FIELDS){
      if (isKV) s += v[k];
    }
    return s;
  }

  function abzugsfaehigBasis(v){
    // Selbstständig: 91,36% von (GesundheitVARIO + BEA) + 100% Pflegepflicht
    return 0.9136 * (v.g + v.bea) + v.ppv;
  }

  function arbeitgeberZuschuss(v){
    // 50% bis Cap (KV-Gruppe) + 50% Pflegepflicht bis Pflege-Cap
    const kvGroup = sumKVGroup(v);
    const kv = Math.min(0.5 * kvGroup, CAPS.kv);
    const pf = Math.min(0.5 * v.ppv, CAPS.pflege);
    return kv + pf;
  }

  function computeSide(v, profil, steuersatz){
    const total = sumAll(v);
    const abzBasis = abzugsfaehigBasis(v);
    const s = steuersatz;

    if (profil === "Selbstständig"){
      const vorSteuer = total;
      const gutschrift = s * abzBasis;           // Steuerersparnis
      const nachSteuer = vorSteuer - gutschrift; // Nettobelastung nach Steuer
      return { vorSteuer, nachSteuer, gutschrift, ag: 0, abzBasis };
    }

    // Arbeitnehmer:
    const ag = arbeitgeberZuschuss(v);
    const vorSteuer = Math.max(0, total - ag);        // Arbeitnehmer zahlt nach AG-Zuschuss
    const abzAN = Math.max(0, abzBasis - ag);         // abzugsfähiger Arbeitnehmeranteil (wie vorher)
    const gutschrift = s * abzAN;                     // Steuerersparnis
    const nachSteuer = vorSteuer - gutschrift;        // Nettobelastung nach Steuer
    return { vorSteuer, nachSteuer, gutschrift, ag, abzBasis };
  }

  function render(){
    const labelL = document.getElementById("labelL").value || "Links";
    const labelR = document.getElementById("labelR").value || "Rechts";
    document.getElementById("hdrL").textContent = labelL;
    document.getElementById("hdrR").textContent = labelR;

    const profil = document.getElementById("profil").value;
    const steuersatz = Math.max(0, Math.min(100, toNum(document.getElementById("steuer").value))) / 100;

    const L = readSide("L");
    const R = readSide("R");

    const resL = computeSide(L, profil, steuersatz);
    const resR = computeSide(R, profil, steuersatz);

    // Output block:
    // 1) Gesamtbetrag vor Steuer
    // 2) Gesamtbetrag nach Steuer
    // 3) Gutschrift nach Steuer (Steuerersparnis)
    let html = "";

    // Optional: beim Arbeitnehmer zusätzlich AG-Zuschuss anzeigen (hilfreich/transparent)
    if (profil === "Arbeitnehmer"){
      html += `
        <div class="rowlabel">Arbeitgeberzuschuss (berechnet, max. KV ${CAPS.kv.toFixed(2)} / Pflege ${CAPS.pflege.toFixed(2)})</div>
        <div class="cell bgL bold">-${money(resL.ag).replace(" €","")} €</div>
        <div class="cell bgR bold">-${money(resR.ag).replace(" €","")} €</div>
      `;
    }

    html += `
      <div class="rowlabel bold">Gesamtbetrag vor Steuer</div>
      <div class="cell bgL bold">${money(resL.vorSteuer)}</div>
      <div class="cell bgR bold">${money(resR.vorSteuer)}</div>

      <div class="rowlabel bold">Gesamtbetrag nach Steuer</div>
      <div class="cell bold" style="background:#047857;color:#fff">${money(resL.nachSteuer)}</div>
      <div class="cell bold" style="background:#6d28d9;color:#fff">${money(resR.nachSteuer)}</div>

      <div class="rowlabel bold">Gutschrift nach Steuer</div>
      <div class="cell bgL bold">${money(resL.gutschrift)}</div>
      <div class="cell bgR bold">${money(resR.gutschrift)}</div>
    `;

    document.getElementById("out").innerHTML = html;
  }

  // Bind events
  const allInputs = document.querySelectorAll("input, select");
  allInputs.forEach(el => el.addEventListener("input", render));
  render();
</script>

</body>
</html>

